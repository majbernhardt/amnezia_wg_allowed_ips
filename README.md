# Диапазоны IP-адресов для WG-конфигурации (Split-Tunnel для Telegram, Discord, Google, YouTube)

Этот документ описывает содержимое параметра `AllowedIPs` для WG-конфига

Цель — направлять трафик **только выбранных сервисов** через зашифрованный туннель, минимизируя нагрузку и сохраняя скорость для остального трафика

## Полный список IP-адресов для вставки в конфиг

```ini
AllowedIPs = 162.159.0.0/16, 66.22.0.0/16, 8.8.4.0/24, 8.8.8.0/24, 8.34.208.0/20, 8.35.192.0/20, 23.236.48.0/20, 23.251.128.0/19, 34.0.0.0/10, 35.184.0.0/13, 35.192.0.0/14, 35.196.0.0/15, 35.198.0.0/16, 35.199.0.0/17, 35.199.128.0/18, 35.200.0.0/13, 35.208.0.0/12, 64.18.0.0/20, 64.233.160.0/19, 66.102.0.0/20, 66.249.64.0/19, 70.32.128.0/19, 72.14.192.0/18, 74.114.24.0/21, 74.125.0.0/16, 104.132.0.0/23, 104.133.0.0/23, 104.134.0.0/15, 104.156.64.0/18, 104.237.160.0/19, 108.59.80.0/20, 108.170.192.0/18, 108.177.0.0/17, 130.211.0.0/16, 136.112.0.0/12, 142.250.0.0/15, 146.148.0.0/17, 162.216.148.0/22, 162.222.176.0/21, 172.110.32.0/21, 172.217.0.0/16, 172.253.0.0/16, 173.194.0.0/16, 173.255.112.0/20, 192.158.28.0/22, 192.178.0.0/15, 193.186.4.0/24, 199.36.154.0/23, 199.36.156.0/24, 199.192.112.0/22, 199.223.232.0/21, 207.223.160.0/20, 208.65.152.0/22, 208.68.108.0/22, 208.81.188.0/22, 208.117.224.0/19, 209.85.128.0/17, 216.58.192.0/19, 216.239.32.0/19, 216.239.36.0/24, 216.239.38.0/23, 216.239.40.0/22, 104.18.37.228/32, 188.114.99.235/32, 34.126.226.51/32, 162.159.128.233/32, 162.159.136.232/32, 91.108.4.0/22, 91.108.8.0/22, 91.108.56.0/22, 95.161.64.0/20, 95.161.80.0/24, 149.154.160.0/20
```

## Где размещается `AllowedIPs`

Параметр `AllowedIPs` находится **внутри секции `[Peer]`** конфига и определяет, **какой трафик направлять через туннель**

### Пример структуры конфига:

```ini
[Interface]
PrivateKey = <твой_ключ>
Address = 1.2.3.4/32
DNS = 1.1.1.1, 1.0.0.1
# ... другие параметры (Jc, Jmin и т.д.)

[Peer]
PublicKey = <публичный_ключ_сервера>
PresharedKey = <опционально>
Endpoint = 1.2.3.4:12345 # IP-адрес сервера и порт на котором развёрнута Amnezia

# СЮДА ВСТАВЛЯЕТСЯ СПИСОК AllowedIPs
AllowedIPs = 91.108.4.0/22,149.154.160.0/20,162.159.0.0/16,...
```

> **Важно**:
- `AllowedIPs` — **одна строка**, все подсети перечисляются через запятую **без пробелов**
- Комментарии (`# ...`) **нельзя вставлять внутрь значения `AllowedIPs`** — они нарушат работу конфига

## Группировка IP-диапазонов по назначению

Ниже приведены все подсети из конфига, сгруппированные по сервисам. Указаны **только ключевые диапазоны** — мелкие подсети, входящие в более крупные, опущены для читаемости

### 1. Telegram (AS62041)

Основной трафик: **сообщения, голосовые сообщения, звонки, медиафайлы**

| Диапазон | Назначение |
|--------|-----------|
| `91.108.4.0/22` | Основные серверы MTProto |
| `91.108.8.0/22` | Дополнительные серверы |
| `91.108.56.0/22` | Инфраструктура (включает 91.108.56.0–91.108.59.255) |
| `95.161.64.0/20` | Прокси и резервные узлы |
| `95.161.80.0/24` | Отдельный блок вне `/20` выше |
| `149.154.160.0/20` | **Главный диапазон** Telegram (149.154.160.0–149.154.175.255) |

### 2. Discord (через Cloudflare)

Discord полностью работает через **Cloudflare CDN**. Эти IP обеспечивают подключение к голосовым каналам, чатам и медиа

| Диапазон | Назначение |
|--------|-----------|
| `162.159.0.0/16` | Основной диапазон Cloudflare (используется Discord) |
| `104.18.37.228/32` `188.114.99.235/32` `162.159.128.233/32` `162.159.136.232/32` | Конкретные IP-адреса Discord-серверов |

**Рекомендация**: Достаточно `162.159.0.0/16`, но конкретные `/32` повышают надёжность

### 3. YouTube / Google / Android / Gmail / Google Cloud

Огромный блок Google-сервисов. Включает YouTube, поиск, почту, облако, API и CDN

| Диапазон | Назначение |
|--------|-----------|
| `8.8.8.0/24`, `8.8.4.0/24` | Google Public DNS |
| `172.217.0.0/16` | YouTube, Search, основные веб-сервисы |
| `142.250.0.0/15` | YouTube, Drive, Gmail |
| `74.125.0.0/16`, `216.58.192.0/19` | Классические Google-сервисы |
| `34.0.0.0/10` | Google Cloud Platform (GCP), Firebase |
| `35.184.0.0/13` и другие `35.x.x.x` | GCP регионы |
| `108.177.0.0/17` | Android, YouTube API |
| `130.211.0.0/16` | Google Kubernetes Engine (GKE) |
| *(+ десятки других подсетей)* | Резервные и региональные узлы |

**Рекомендация**: Если используешь **только YouTube**, можно оставить:

```text
8.8.8.0/24, 8.8.4.0/24, 172.217.0.0/16, 142.250.0.0/15, 216.58.192.0/19
```

### 4. Прочие сервисы

Дополнительные подсети Cloudflare и Google, которые могут использоваться Telegram (для медиа через CDN) или сторонними сайтами

| Диапазон | Комментарий |
|--------|-----------|
| `162.216.148.0/22` |
| `162.222.176.0/21` |
| `34.126.226.51/32` | Принадлежит **Google Cloud**, не AWS |

## Как обновлять список
1. **Добавить новый сервис** → найди его ASN (например, через `whois -h whois.radb.net -- '-i origin ASxxxxx'`)
2. **Проверить текущие IP** → используй `ss -tunp` или Wireshark во время работы приложения
3. **Обновить `AllowedIPs`** → вставь новую строку в секцию `[Peer]`

## Советы по оптимизации

- Если ты **не используешь Gmail, Drive или GCP**, можно удалить большинство `35.x.x.x` и `130.211.0.0/16`
- Для **только Telegram + Discord** достаточно:
  ```text
  91.108.4.0/22,91.108.8.0/22,91.108.56.0/22,95.161.64.0/20,95.161.80.0/24,149.154.160.0/20,162.159.0.0/16
  ```  
